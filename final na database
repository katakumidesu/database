CREATE TABLE orders (
  order_id int(11) NOT NULL,
  user_id int(11) DEFAULT NULL,
  customer_name varchar(99) NOT NULL,
  customer_phone varchar(99) NOT NULL,
  oder_date timestamp NOT NULL DEFAULT current_timestamp(),
  status enum('pending','processing','shipped','delivered','cancelled') DEFAULT 'pending',
  total_amount decimal(10,0) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE delivery (
  delivery_id int(11) NOT NULL,
  order_id int(11) DEFAULT NULL,
  country varchar(100) DEFAULT 'philippines',
  delivery_date date DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE order_items (
  item_id int(11) NOT NULL,
  order_id int(11) NOT NULL,
  product_name varchar(255) NOT NULL,
  quantity int(11) NOT NULL,
  price decimal(10,2) NOT NULL,
  image_url varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE payments (
  payment_id int(11) NOT NULL,
  order_id int(11) DEFAULT NULL,
  amount decimal(10,0) NOT NULL,
  payment_date timestamp NOT NULL DEFAULT current_timestamp(),
  method enum('credit card','debit card','cash','cod','gcash') NOT NULL,
  proof_path varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE products (
  product_id int(11) NOT NULL,
  name varchar(99) NOT NULL,
  description text DEFAULT NULL,
  price decimal(10,2) NOT NULL,
  rating decimal(2,1) DEFAULT NULL,
  stock int(11) DEFAULT 0,
  image_url varchar(255) DEFAULT NULL,
  create_at timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE product_ratings (
  rating_id int(11) NOT NULL,
  product_name varchar(255) NOT NULL,
  user_id int(11) DEFAULT NULL,
  username varchar(255) DEFAULT NULL,
  stars tinyint(4) NOT NULL,
  review text DEFAULT NULL,
  created_at datetime DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE users (
  user_id int(11) NOT NULL,
  username varchar(99) DEFAULT NULL,
  name varchar(99) NOT NULL,
  email varchar(99) NOT NULL,
  password_hash varchar(99) NOT NULL,
  phone varchar(20) NOT NULL,
  gender enum('Male','Female','Other') DEFAULT 'Other',
  birthdate date DEFAULT NULL,
  profile_image varchar(255) DEFAULT 'default.png',
  role enum('user','admin') DEFAULT 'user',
  created_at timestamp NOT NULL DEFAULT current_timestamp(),
  updated_at timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE user_addresses (
  address_id int(11) NOT NULL,
  user_id int(11) NOT NULL,
  fullname varchar(120) NOT NULL,
  phone varchar(32) NOT NULL,
  label varchar(20) DEFAULT 'Home',
  address_line varchar(255) NOT NULL,
  barangay varchar(120) DEFAULT '',
  city varchar(120) NOT NULL,
  province varchar(120) DEFAULT '',
  postal_code varchar(16) DEFAULT '',
  is_default tinyint(1) NOT NULL DEFAULT 0,
  created_at timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;



ALTER TABLE delivery
  ADD PRIMARY KEY (delivery_id),
  ADD KEY order_id (order_id);

--
-- Indexes for table orders
--
ALTER TABLE orders
  ADD PRIMARY KEY (order_id),
  ADD KEY user_id (user_id);

--
-- Indexes for table order_items
--
ALTER TABLE order_items
  ADD PRIMARY KEY (item_id),
  ADD KEY order_id (order_id);

--
-- Indexes for table payments
--
ALTER TABLE payments
  ADD PRIMARY KEY (payment_id),
  ADD KEY order_id (order_id);

--
-- Indexes for table products
--
ALTER TABLE products
  ADD PRIMARY KEY (product_id);

--
-- Indexes for table product_ratings
--
ALTER TABLE product_ratings
  ADD PRIMARY KEY (rating_id);

--
-- Indexes for table users
--
ALTER TABLE users
  ADD PRIMARY KEY (user_id),
  ADD UNIQUE KEY email (email),
  ADD UNIQUE KEY username (username);

--
-- Indexes for table user_addresses
--
ALTER TABLE user_addresses
  ADD PRIMARY KEY (address_id),
  ADD KEY idx_user (user_id);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table delivery
--
ALTER TABLE delivery
  MODIFY delivery_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=4;

--
-- AUTO_INCREMENT for table orders
--
ALTER TABLE orders
  MODIFY order_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=191;

--
-- AUTO_INCREMENT for table order_items
--
ALTER TABLE order_items
  MODIFY item_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=202;

--
-- AUTO_INCREMENT for table payments
--
ALTER TABLE payments
  MODIFY payment_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=11;

--
-- AUTO_INCREMENT for table products
--
ALTER TABLE products
  MODIFY product_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=30;

--
-- AUTO_INCREMENT for table product_ratings
--
ALTER TABLE product_ratings
  MODIFY rating_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- AUTO_INCREMENT for table users
--
ALTER TABLE users
  MODIFY user_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=44;

--
-- AUTO_INCREMENT for table user_addresses
--
ALTER TABLE user_addresses
  MODIFY address_id int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

--
-- Constraints for dumped tables
--

--
-- Constraints for table delivery
--
ALTER TABLE delivery
  ADD CONSTRAINT delivery_ibfk_1 FOREIGN KEY (order_id) REFERENCES orders (order_id);

--
-- Constraints for table orders
--
ALTER TABLE orders
  ADD CONSTRAINT orders_ibfk_1 FOREIGN KEY (user_id) REFERENCES users (user_id);

--
-- Constraints for table order_items
--
ALTER TABLE order_items
  ADD CONSTRAINT order_items_ibfk_1 FOREIGN KEY (order_id) REFERENCES orders (order_id) ON DELETE CASCADE;

--
-- Constraints for table payments
--
ALTER TABLE payments
  ADD CONSTRAINT payments_ibfk_1 FOREIGN KEY (order_id) REFERENCES orders (order_id);

--
-- Constraints for table user_addresses
--
ALTER TABLE user_addresses
  ADD CONSTRAINT fk_addr_user FOREIGN KEY (user_id) REFERENCES users (user_id) ON DELETE CASCADE;
COMMIT;
